<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="description"
      content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5"
    />
    <meta name="author" content="AdminKit" />
    <meta
      name="keywords"
      content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web"
    />

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link rel="shortcut icon" href="img/icons/icon-48x48.png" />

    <link rel="canonical" href="https://demo-basic.adminkit.io/" />

    <title>Admin Panel</title>

    <link href="../css/admin-css/app.css" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css"
    />
  

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  </head>
<body>
  <div class="wrapper">
    <nav id="sidebar" class="sidebar js-sidebar">
      <div class="sidebar-content js-simplebar">
        <a class="sidebar-brand" href="/admin">
          <span class="align-middle">Admin Panel</span>
        </a>

        <ul class="sidebar-nav">
          <li class="sidebar-header">Pages</li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin">
              <i class="align-middle" data-feather="monitor"></i>
              <span class="align-middle">Dashboard</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin/products">
              <i class="align-middle" data-feather="shopping-bag"></i>
              <span class="align-middle">Products</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin/categoryView">
              <i class="align-middle" data-feather="layers"></i>
              <span class="align-middle">Category</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin/user">
              <i class="align-middle" data-feather="users"></i>
              <span class="align-middle">Users</span>
            </a>
          </li>

          <li class="sidebar-item active">
            <a class="sidebar-link" href="/admin/orderStatus">
              <i class="align-middle" data-feather="package"></i>
              <span class="align-middle">Order Status</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin/salesReport">
              <i class="align-middle" data-feather="package"></i>
              <span class="align-middle">Sales Report</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin/coupons">
              <i class="align-middle" data-feather="command"></i>
              <span class="align-middle">Coupons</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin/offers">
              <i class="align-middle" data-feather="command"></i>
              <span class="align-middle">Offers</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" href="/admin/banner">
              <i class="align-middle" data-feather="bookmark"></i>
              <span class="align-middle">Banner</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="main">
      <nav class="navbar navbar-expand navbar-light navbar-bg">
        <a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>

        <div class="navbar-collapse collapse">
          <ul class="navbar-nav navbar-align">
            <li class="nav-item dropdown">
              <a
                class="nav-icon dropdown-toggle d-inline-block d-sm-none"
                href="#"
                data-bs-toggle="dropdown"
              >
                <i class="align-middle" data-feather="settings"></i>
              </a>

              <a
                class="nav-link dropdown-toggle d-none d-sm-inline-block"
                href="#"
                data-bs-toggle="dropdown"
              >
                <img
                  src="../images/login-images/avatar.jpg"
                  class="avatar img-fluid rounded me-1"
                  alt="Charles Hall"
                />
                <span class="text-dark">Admin</span>
              </a>
              <div class="dropdown-menu dropdown-menu-end">
                <a class="dropdown-item" href="pages-profile.html"
                  ><i class="align-middle me-1" data-feather="user"></i>
                  Profile</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="align-middle me-1" data-feather="pie-chart"></i>
                  Analytics</a
                >
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="index.html"
                  ><i class="align-middle me-1" data-feather="settings"></i>
                  Settings & Privacy</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="align-middle me-1" data-feather="help-circle"></i>
                  Help Center</a
                >
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="/logout">Log out</a>
              </div>
            </li>
          </ul>
        </div>
      </nav>

      <main class="content">
        <style>
            #datatables-reponsive {
                border-collapse: collapse;
                width: 100%;
            }
        
            #datatables-reponsive th,
            #datatables-reponsive td {
                padding: 12px;
                text-align: left;
                border: 1px solid #ddd;
            }
        
            #datatables-reponsive th {
                background-color: #f2f2f2;
            }
        
            #datatables-reponsive tr:nth-child(even) {
                background-color: #f9f9f9;
            }
        
            #datatables-reponsive tr:hover {
                background-color: #ddd;
            }
        
            @media only screen and (max-width: 768px) {
        
                #datatables-reponsive,
                #datatables-reponsive thead,
                #datatables-reponsive tbody,
                #datatables-reponsive th,
                #datatables-reponsive td,
                #datatables-reponsive tr {
                    display: block;
                }
        
                #datatables-reponsive thead tr {
                    position: absolute;
                    top: -9999px;
                    left: -9999px;
                }
        
                #datatables-reponsive td {
                    border: none;
                    position: relative;
                    padding-left: 50%;
                    text-align: left;
                }
        
                #datatables-reponsive td:before {
                    position: absolute;
                    top: 6px;
                    left: 6px;
                    width: 45%;
                    padding-right: 10px;
                    white-space: nowrap;
                    content: attr(data-label);
                    font-weight: bold;
                    text-align: right;
                }
        
                #datatables-reponsive td:last-child:before {
                    content: none;
                }
            }
        
            .btn:hover {
                background-color: #212529;
                border-color: #212529;
            }
        </style>
        
       
            <div class="">
                <h1 class="h3 mb-3">Sales Report</h1>
        
                <div class="row">
                    <div class="col-md-12 d-flex justify-content-end">
                        <div class="me-2">
                            <button type="button" onclick="salesReportPdf()" class="btn btn-secondary btn-icon bg-dark">
                                <i class="bi bi-file-earmark-pdf-fill"></i> PDF
                            </button>
        
                            <button type="button" onclick="salesReportExcel()" class="btn btn-secondary btn-icon bg-dark">
                                <i class="bi bi-file-earmark-excel-fill"></i> Excel
                            </button>
                        </div>
                    </div>
        
                    <div class="col-md-12 d-flex justify-content-start">
              
                      <form action="/admin/Sales-report" method="post">
                          <select name="selector" id="my-dropdown" class="form-select form-select-sm bg-light border-0" style="box-shadow: 0 0 3px;">
                              <option value="0">View sales Report</option>
      
                              <optgroup label="Yearly">
                                  <option value="year-<%= new Date().getFullYear() %>">
                                      <%= new Date().getFullYear() %>
                                  </option>
                                  <option value="year-<%= new Date().getFullYear()-1 %>">
                                      <%= new Date().getFullYear()-1 %>
                                  </option>
                              </optgroup>
      
                              <optgroup label="Monthly">
                                  <option value="month-<%= new Date().getFullYear() %>-<%= new Date().getMonth()+1 %>">
                                      <%= new Date().toLocaleString('default', { month: 'long' }) + " " + new Date().getFullYear() %>
                                  </option>
                                  <option value="month-<%= new Date().getFullYear() %>-<%= new Date().getMonth() %>">
                                      <%= new Date(new Date().getFullYear(), new Date().getMonth()-1, 1).toLocaleString('default', { month: 'long' }) + " " + new Date().getFullYear() %>
                                  </option>
                              </optgroup>
      
                              <optgroup label="Weekly">
                                  <option value="week-<%= getWeekStartDate() %>">
                                      This Week
                                  </option>
      
                              </optgroup>
      
                              <optgroup label="Daily">
                                  <option value="day-<%= new Date().toISOString().slice(0,10) %>">
                                      Today
                                  </option>
                                  <option value="day-<%= new Date(Date.now() - 86400000).toISOString().slice(0,10) %>">
                                      Yesterday
                                  </option>
                              </optgroup>
                          </select>
                          <% function getWeekStartDate(offset=0) {
                      var d = new Date();
                      var day = d.getDay() - offset;
                      var weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate() - day);
                      return weekStart.toISOString().slice(0, 10);
                } %>
      
                          <button type="submit" class="btn btn-info">Get Orders</button>
                      </form>
      
                  </div>
        
        
                    <div class="col-12 mt-3">
                        <div class="card">
        
                            <div class="card-body">
                                <table id="datatables-reponsive" class="table table-striped" style="width:100%">
                                    <thead>
                                        <tr>
                                            <!-- <th>Transaction Id</th> -->
        
                                            <th>Date of Order</th>
                                            <th>Product</th>
                                            <th>Quantity</th>
                                            <th>Amount</th>
                                            <th>Tax</th>
                                            <th>Mode of payment</th>
                                            <th>payment status</th>
                                            <th>order status</th>
        
        
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% locals.orders.forEach(element=> { %>
                                            <% element.products.forEach(prd=> { %>
                                                <tr>
                                                    <!-- <td><%#= element._id %></td> -->
        
                                                    <td>
                                                        <%= new Date(element.createdAt).toLocaleString('en-US', { month: 'short'
                                                            , day: 'numeric' , year: 'numeric' , hour12: true }) %>
                                                    </td>
                                                    <td><%= prd.name %></td>
                                                    <td>
                                                        <%= prd.quantity %>
                                                    </td>
                                                    <td>Rs:<%= (prd.currentPrice+prd.tax)*(prd.quantity) %>
                                                    </td>
                                                    <td>Rs:<%= (prd.tax)*(prd.quantity) %>
                                                    </td>
                                                    <td>
                                                        <%= element.paymentMethod %>
                                                    </td>
                                                    <td>
                                                        <%= element.paymentstatus %>
                                                    </td>
                                                    <td>
                                                        <%= prd.orderstatus %>
                                                    </td>
        
                                                </tr>
                                                <% }) %>
                                                    <% }) %>
        
        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
       
         

      </main>


    </div>
  </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>
<script type="text/javascript" src="/javascripts/tableToExcel.js"></script>
<script src="https://unpkg.com/html-to-text@8.0.0/html-to-text.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>


<script>
  $(document).ready(function () {
      $("#datatables-reponsive").DataTable();
  });
</script>


<script>

  document.getElementById("my-dropdown").addEventListener("change", function () {
      var selectedValue = this.value;
      console.log(selectedValue, "sese");
      if (selectedValue === "year") {
          document.getElementById("yearDiv").style.display = "block";
          document.getElementById("monthDiv").style.display = "none";
          document.getElementById("dayDiv").style.display = "none";
      } else if (selectedValue === "month") {
          document.getElementById("yearDiv").style.display = "block";
          document.getElementById("monthDiv").style.display = "block";
          document.getElementById("dayDiv").style.display = "none";
      } else if (selectedValue === "day") {
          document.getElementById("yearDiv").style.display = "block";
          document.getElementById("monthDiv").style.display = "block";
          document.getElementById("dayDiv").style.display = "block";
      } else {
          document.getElementById("yearDiv").style.display = "none";
          document.getElementById("monthDiv").style.display = "none";
          document.getElementById("dayDiv").style.display = "none";
      }
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>
<script type="text/javascript" src="/javascripts/tableToExcel.js"></script>
<script src="https://unpkg.com/html-to-text@8.0.0/html-to-text.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>

<script>
 

    function salesReportPdf() {
        var doc = new jsPDF("p", "pt", "letter");
        var table = document.getElementById("datatables-reponsive");

        doc.autoTable({ html: table });

        doc.save("Orders.pdf");
    }




    // function salesReportExcel() {
    //     TableToExcel.convert(document.getElementById("datatables-reponsive"));
    // }

    function salesReportExcel() {
  var wb = XLSX.utils.book_new();
  var ws = XLSX.utils.table_to_sheet(document.querySelector('#datatables-reponsive'));

  // Adjust column widths
  ws['!cols'] = [
    { wch: 20 }, // Customer Name
    { wch: 10 }, // Order ID
    { wch: 20 }, // Product Name
    { wch: 10 }, // Quantity
    { wch: 15 }, // Unit Price
    { wch: 15 }, // Total Price
  ];

  XLSX.utils.book_append_sheet(wb, ws, "Sales Report");

  // Save the Excel file
  XLSX.writeFile(wb, "Sales Report.xlsx");
}

</script>